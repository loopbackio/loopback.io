"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[4472],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),h=a,m=u["".concat(l,".").concat(h)]||u[h]||d[h]||i;return n?o.createElement(m,r(r({ref:t},c),{},{components:n})):o.createElement(m,r({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var p=2;p<i;p++)r[p]=n[p];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7707:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},assets:function(){return c},toc:function(){return d},default:function(){return h}});var o=n(7462),a=n(3366),i=(n(7294),n(3905)),r=["components"],s={title:"LoopBack 4 December 2018 Milestone Update",date:new Date("2019-01-09T00:00:00.000Z"),authors:"jannyhou",slug:"december-2018-milestone",tags:["Milestone update"]},l=void 0,p={permalink:"/blog/december-2018-milestone",editUrl:"https://github.com/loopbackio/loopback-blog/blog/2019/2019-01-09-december-milestone.md",source:"@site/blog/2019/2019-01-09-december-milestone.md",title:"LoopBack 4 December 2018 Milestone Update",description:"Happy New Year! We hope everyone had a wonderful holiday and warmly welcomed 2019. This past December was a short month due to the vacation days, but we were still able to complete several fixes and take off in our next focused epics like authentication and building a JavaScript LoopBack 4 application. You can read more about our progress below.",date:"2019-01-09T00:00:00.000Z",formattedDate:"January 9, 2019",tags:[{label:"Milestone update",permalink:"/blog/tags/milestone-update"}],readingTime:8.115,truncated:!0,authors:[{name:"Janny Hou",title:"LoopBack Maintainer",url:"https://github.com/jannyhou",imageURL:"https://avatars2.githubusercontent.com/u/12554153",key:"jannyhou"}],frontMatter:{title:"LoopBack 4 December 2018 Milestone Update",date:"2019-01-09T00:00:00.000Z",authors:"jannyhou",slug:"december-2018-milestone",tags:["Milestone update"]},prevItem:{title:"Meetup - Quickly Build APIs with Existing Services and Data Using LoopBack!",permalink:"/blog/meetup-quickly-build-apis-using-loopback"}},c={authorsImageUrls:[void 0]},d=[{value:"Community Contribution",id:"community-contribution",children:[],level:2},{value:"Authentication and Authorization",id:"authentication-and-authorization",children:[],level:2},{value:"Relation Epic",id:"relation-epic",children:[{value:"Support hasOne relation",id:"support-hasone-relation",children:[],level:3},{value:"Inclusion Spike",id:"inclusion-spike",children:[],level:3}],level:2},{value:"Documents",id:"documents",children:[{value:"Contribution Guide",id:"contribution-guide",children:[],level:3},{value:"API Documents",id:"api-documents",children:[],level:3}],level:2},{value:"Extensible Request Body Parsing Blog",id:"extensible-request-body-parsing-blog",children:[],level:2},{value:"Write Loopback 4 App in JavaScript",id:"write-loopback-4-app-in-javascript",children:[],level:2},{value:"OpenAPI Specifications",id:"openapi-specifications",children:[{value:"Base Path",id:"base-path",children:[],level:3},{value:"Models for Anonymous Schema",id:"models-for-anonymous-schema",children:[],level:3}],level:2},{value:"Context Improvement",id:"context-improvement",children:[],level:2},{value:"Tslint Configurations",id:"tslint-configurations",children:[],level:2},{value:"LoopBack 3 Support",id:"loopback-3-support",children:[],level:2},{value:"Call to Action",id:"call-to-action",children:[],level:2}],u={toc:d};function h(e){var t=e.components,s=(0,a.Z)(e,r);return(0,i.kt)("wrapper",(0,o.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Happy New Year! We hope everyone had a wonderful holiday and warmly welcomed 2019. This past December was a short month due to the vacation days, but we were still able to complete several fixes and take off in our next focused epics like authentication and building a JavaScript LoopBack 4 application. You can read more about our progress below."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"LoopBack 4 December 2018 Milestone Update",src:n(3980).Z,width:"1247",height:"471"})),(0,i.kt)("h2",{id:"community-contribution"},"Community Contribution"),(0,i.kt)("p",null,"In December we received several document updates and code refactor PRs to improve our code base and user experience. Our LoopBack team appreciates all the contributions that community members have made through the past year. We look forward to continually improving LoopBack 4 with you in the new year! Thank you for participating in the new era of LoopBack."),(0,i.kt)("h2",{id:"authentication-and-authorization"},"Authentication and Authorization"),(0,i.kt)("p",null,"For the first refactoring task of the authentication component, we started by implementing a JWT strategy in the shopping example. We did this to discover the common abstractions among different authentication strategies, and to explore ways of defining the default LoopBack 4 User model integrated with authorization methods like login and logout."),(0,i.kt)("p",null,"During the implementation, we found some twisted concepts that could confuse people in terms of how each layer's metadata are injected and the mechanism of how the authentication component works. We created a diagram depicting the dependency relations and functionality of each concept to guide community contributors. You can find it in this ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/issues/1997#issuecomment-450998083"},"comment"),"."),(0,i.kt)("p",null,"We were able to write a PoC PR with the following elements:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"A JWT strategy that verifies a request's permission by the authentication metadata from its header"),(0,i.kt)("li",{parentName:"ul"},"A custom strategy resolver which returns the JWT strategy"),(0,i.kt)("li",{parentName:"ul"},"An AccessToken model that has a one-to-many relation to the User model"),(0,i.kt)("li",{parentName:"ul"},"A sign in endpoint in the User controller that finds a user and creates the JWT access token")),(0,i.kt)("p",null,"The PR is still in progress. We will summarize the required elements and the steps to create them in the document when it's done. Our next focus would be extracting the pieces in the PoC PR into proper modules, including our existing ",(0,i.kt)("inlineCode",{parentName:"p"},"@loopback/authentication")," package or a new created extension package. You can check story ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/issues/1997"},"#1997")," to track the discussions."),(0,i.kt)("h2",{id:"relation-epic"},"Relation Epic"),(0,i.kt)("h3",{id:"support-hasone-relation"},"Support hasOne relation"),(0,i.kt)("p",null,"With the ",(0,i.kt)("inlineCode",{parentName:"p"},"hasMany")," relation feature in place and with a lot of request from our community, it made logical sense to implement ",(0,i.kt)("inlineCode",{parentName:"p"},"hasOne")," relation next. The first iteration ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/pull/1879"},"1879")," involved an acceptance test to drive the feature with tests for ",(0,i.kt)("inlineCode",{parentName:"p"},"create")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"get")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"find")," methods. However, it was using a race-condition prone approach in order to guarantee that a single related model instance was created for a source instance. The code called the ",(0,i.kt)("inlineCode",{parentName:"p"},"find()")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"create()")," methods on the target repository which can lead to multiple target instances based on the asynchronous nature of those methods (see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/pull/1879#discussion_r227363386"},"this comment")," for a clear example). "),(0,i.kt)("p",null,"In order to address this issue, ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/bajtos"},"Miroslav")," proposed using the target model's Primary Key as the Foreign Key from the source model and let the underlying database enforce uniqueness. With it came ",(0,i.kt)("inlineCode",{parentName:"p"},"belongsToUniquely()")," decorator which is used as part of the target model definition to mark a property as a non-generated ",(0,i.kt)("inlineCode",{parentName:"p"},"id")," field for use with ",(0,i.kt)("inlineCode",{parentName:"p"},"hasOne")," relation. After making sure it works with in-memory and MySQL databases, we concluded that it was universal enough and made sense to delegate uniqueness enforcement at the database level and landed the PR. "),(0,i.kt)("p",null,"However, ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/raymondfeng"},"Raymond")," pointed out that this approach does not indeed enforce uniqueness across all supported connectors. Instead, he proposed to mark the foreign key as a unique index. While ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/b-admike"},"Biniam")," started the implementation in ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/pull/2126"},"2126"),", he discovered that some connectors like ",(0,i.kt)("inlineCode",{parentName:"p"},"in-memory")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"cloudant")," do not have support for ",(0,i.kt)("inlineCode",{parentName:"p"},"unique indexes"),". Raymond, Miroslav, and Biniam discussed HasOne's unique constraint for the foreign key and discovered a new way of looking at relations and constraints:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Weak relations, where the developer primarily wants to navigate related models (think of GraphQL) and referential integrity is either not important or already enforced by the (SQL) database."),(0,i.kt)("li",{parentName:"ul"},"Strong relations, where the referential integrity is guaranteed by the framework together with the database.")),(0,i.kt)("p",null,"Given this and the fact that we don't have a concrete way to enforce referential integrity in LoopBack from the approaches taken thus far, ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/pull/2126"},"#2126")," was put on hold and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/pull/2147"},"2147")," aimed to remove the implementation which used target model's PK as the FK for a ",(0,i.kt)("inlineCode",{parentName:"p"},"hasOne")," relation. The onus is now on users to make sure that referential integrity is enforced by the database they're using by defining a unique index as shown in our ",(0,i.kt)("a",{parentName:"p",href:"https://loopback.io/doc/en/lb4/hasOne-relation.html#setting-up-your-database-for-hasone-relation---mysql"},"docs"),". For more discussion, see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/issues/2127"},"2127")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/issues/1718"},"1718"),"."),(0,i.kt)("h3",{id:"inclusion-spike"},"Inclusion Spike"),(0,i.kt)("p",null,"To explore a good approach for doing the inclusion traverse, we did a spike that implemented an inclusion handler as a function to fetch the included items. When a one to many relation is established, the repository of the source model registers the inclusion handler, which takes in the target model's repository getter, applies constraints and invoke the target repository's ",(0,i.kt)("inlineCode",{parentName:"p"},"find")," method with the inclusion filter."),(0,i.kt)("p",null,"This works well for ",(0,i.kt)("inlineCode",{parentName:"p"},"hasMany")," relation but exposes more high level design problems when implementing the ",(0,i.kt)("inlineCode",{parentName:"p"},"belongsTo")," inclusion handler. The ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/issues/1799"},"circular dependency restriction")," results in two models could not define each other as a property in the model class. Therefore the ",(0,i.kt)("inlineCode",{parentName:"p"},"belongsTo")," relation only has a foreignKey id property but not a relation property in the source model, and as a consequence, the source model couldn't really describe the data included from its parent."),(0,i.kt)("p",null,"Here is a summary of the things we could re-design and improve:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The Filter interface is not designed to describe related entities"),(0,i.kt)("li",{parentName:"ul"},"The relation(inclusion) property shouldn't be part of the model class"),(0,i.kt)("li",{parentName:"ul"},"We need a new design to resolve and describe the inclusion property")),(0,i.kt)("p",null,"The discussion is tracked in ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/issues/2152"},"story 2152"),"."),(0,i.kt)("h2",{id:"documents"},"Documents"),(0,i.kt)("h3",{id:"contribution-guide"},"Contribution Guide"),(0,i.kt)("p",null,"To make users more easier to contribute the code, we cleaned up the ",(0,i.kt)("a",{parentName:"p",href:"https://loopback.io/doc/en/contrib/Reporting-issues.html"},"Reporting issues")," page with a more detailed guide of reporting in appropriate channels, and updated the instructions of filing Loopback 2/3 and Loopback 4 bugs separately."),(0,i.kt)("h3",{id:"api-documents"},"API Documents"),(0,i.kt)("p",null,"We fixed the ",(0,i.kt)("inlineCode",{parentName:"p"},"AuthenticationBindings")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"StrategyAdapter"),"'s API document in the authentication module."),(0,i.kt)("h2",{id:"extensible-request-body-parsing-blog"},"Extensible Request Body Parsing Blog"),(0,i.kt)("p",null,"The API client sends an HTTP request with ",(0,i.kt)("inlineCode",{parentName:"p"},"Content-Type")," header to indicate the media type of the request body. Now we added 6 built-in body parsers for different content types and also allow users to register custom body parser as extensions by implementing the ",(0,i.kt)("inlineCode",{parentName:"p"},"BodyParser")," interface and bind it to the application."),(0,i.kt)("p",null,"To know more about the details, you can read the blog ",(0,i.kt)("a",{parentName:"p",href:"https://strongloop.com/strongblog/the-journey-to-extensible-request-body-parsing"},"The journey to extensible request body parsing")),(0,i.kt)("h2",{id:"write-loopback-4-app-in-javascript"},"Write Loopback 4 App in JavaScript"),(0,i.kt)("p",null,"We are working on a JavaScript abstraction for LoopBack 4. Using this, JavaScript developers will be able to develop LoopBack 4 applications without having to use TypeScript. You can preview an app using the progress we have made so far at ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback4-example-javascript"},"https://github.com/strongloop/loopback4-example-javascript"),"."),(0,i.kt)("p",null,"The next step is to further optimize the abstraction and make it as seamless as possible."),(0,i.kt)("h2",{id:"openapi-specifications"},"OpenAPI Specifications"),(0,i.kt)("h3",{id:"base-path"},"Base Path"),(0,i.kt)("p",null,"We enabled adding the base path of the REST server by calling the app method ",(0,i.kt)("inlineCode",{parentName:"p"},"app.basePath('/abasepath')")," or server method ",(0,i.kt)("inlineCode",{parentName:"p"},"server.basePath('/abasepath')"),". The base path can be provided in the configuration too:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"}," const app = new RestApplication({\n   rest: {\n     basePath: '/api',\n   },\n });\n")),(0,i.kt)("h3",{id:"models-for-anonymous-schema"},"Models for Anonymous Schema"),(0,i.kt)("p",null,"Previously when creating LoopBack 4 artifacts by ",(0,i.kt)("inlineCode",{parentName:"p"},"lb4 openapi"),", the controller class used inline TypeScript type literals to describe the object/array parameters for anonymous schemas. Therefore we introduced a flag called ",(0,i.kt)("inlineCode",{parentName:"p"},"--promote-anonymous-schemas")," to generate separate model classes/types for them. A good use case for turning on the flag would be generating models for the anonymous objects that describe a POST/PATCH operation's responses. For a more detailed usage of the flag and the conventions of the created LoopBack 4 model, please check ",(0,i.kt)("a",{parentName:"p",href:"https://loopback.io/doc/en/lb4/OpenAPI-generator.html"},"the documentation of OpenAPI generator")),(0,i.kt)("h2",{id:"context-improvement"},"Context Improvement"),(0,i.kt)("p",null,"To avoid duplicating the binding configuration every time the users are applying the same attributes such as tags and scope, we allow applying a template function to a binding in the following way:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"\nexport const serverTemplate = (binding: Binding) =>\n  binding.inScope(BindingScope.SINGLETON).tag('server');\n\nconst serverBinding = new Binding<RestServer>('servers.RestServer1');\nserverBinding.apply(serverTemplate);\n")),(0,i.kt)("p",null,"We also polished the binding related documentation and extracted them into a standalone page ",(0,i.kt)("a",{parentName:"p",href:"https://loopback.io/doc/en/lb4/Binding.html"},"Binding")),(0,i.kt)("h2",{id:"tslint-configurations"},"Tslint Configurations"),(0,i.kt)("p",null,"The built-in ",(0,i.kt)("inlineCode",{parentName:"p"},"no-unused-variable")," rule raised many issues like conflicts with other rules and it's also been deprecated. As a solution, we are replacing it with another configuration property ",(0,i.kt)("inlineCode",{parentName:"p"},"no-unused"),". This causes a possible breaking change and therefore a new standalone package ",(0,i.kt)("inlineCode",{parentName:"p"},"@loopback/tslint-config")," is created to separate the major version bump for changing the tslint configurations from ",(0,i.kt)("inlineCode",{parentName:"p"},"@loopback/build"),". You can check ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/pull/2159"},"PR#2159")," for details."),(0,i.kt)("h2",{id:"loopback-3-support"},"LoopBack 3 Support"),(0,i.kt)("p",null,"Since LB2 will reach its end of line by April 2019, we're searching through the modules in the StrongLoop organization and updating LoopBack dependencies from version to 2 to version 3. We updated ",(0,i.kt)("inlineCode",{parentName:"p"},"loopback-workspace")," from a LoopBack 2 application to LoopBack 3 application without changing any behaviours of its APIs. As part of the update, the ",(0,i.kt)("inlineCode",{parentName:"p"},"WorkspaceEntity")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"Definition")," models were removed from the model configuration file, as they are not meant to be accessed directly and they are not attached to a datasource. Finally, the application has been updated to use Node 6+ and the application's dependencies have also been updated to their latest versions."),(0,i.kt)("p",null,"You can find out more in our ",(0,i.kt)("a",{parentName:"p",href:"https://loopback.io/doc/en/contrib/Long-term-support.html"},"LTS schedule"),"."),(0,i.kt)("h2",{id:"call-to-action"},"Call to Action"),(0,i.kt)("p",null,"LoopBack's future success depends on you. We appreciate your continuous support and engagement to make LoopBack even better and meaningful for your API creation experience. Please join us and help the project by:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/strongloop/loopback-next/issues"},"Reporting issues"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/strongloop/loopback-next/blob/master/docs/CONTRIBUTING.md"},"Contributing"),"\ncode and documentation."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/strongloop/loopback-next/labels/good%20first%20issue"},'Opening a pull request on one of our "good first issues"'),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/strongloop/loopback-next/issues/110"},"Joining")," our user group.")))}h.isMDXComponent=!0},3980:function(e,t,n){t.Z=n.p+"assets/images/LoopBack-4-December-2018-Milestone-Update-0cddccdd224f069fad6852d2a9d92325.png"}}]);